# é«˜å¹¶å‘ç¥¨åŠ¡å¹³å°ï¼šé¡¹ç›®æ€»ä½“è§„åˆ’ä¸è·¯çº¿å›¾
æœ¬æ–‡æ¡£æ—¨åœ¨å…¨é¢æ¢³ç†é«˜å¹¶å‘ç¥¨åŠ¡å¹³å°é¡¹ç›®çš„æ€»ä½“ç›®æ ‡ã€å½“å‰è¿›å±•ã€æœªæ¥è§„åˆ’ä»¥åŠæŠ€æœ¯ä¼˜åŒ–æ–¹å‘ï¼Œä½œä¸ºé¡¹ç›®åç»­å¼€å‘çš„æ ¸å¿ƒæŒ‡å¯¼è“å›¾ã€‚

1. é¡¹ç›®æ„¿æ™¯ä¸æœ€ç»ˆç›®æ ‡ (The Goal)
æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ„å»ºä¸€ä¸ªç”Ÿäº§çº§åˆ«çš„ã€é«˜å¹¶å‘ã€é«˜å¯ç”¨çš„åˆ†å¸ƒå¼ç¥¨åŠ¡ç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿä¸ä»…èƒ½åº”å¯¹ç±»ä¼¼å¤§å‹æ¼”å”±ä¼šå¼€ç¥¨æ—¶çš„æµé‡æ´ªå³°ï¼Œè¿˜åº”å…·å¤‡ä¼˜ç§€çš„æ‰©å±•æ€§ã€å®¹é”™èƒ½åŠ›å’Œå¯ç»´æŠ¤æ€§ï¼Œå…¶æ ¸å¿ƒæ¶æ„ç†å¿µå¯ä»¥è½»æ¾ç§»æ¤åˆ°å…¶ä»–é«˜å¹¶å‘åœºæ™¯ï¼ˆå¦‚ç§’æ€ã€æŠ¢è¯¾ç­‰ï¼‰ã€‚

æ ¸å¿ƒç›®æ ‡æ¸…å• (Main Goals):
- [ ] ğŸš€ ç°ä»£åŒ–æ¡†æ¶å‡çº§ (Spring Boot Best Practices):

  - [âœ“] æ•°æ®è®¿é—®å±‚ï¼šå·²å®Œæˆä»æ‰‹åŠ¨ JdbcTemplate åˆ° Spring Data JPA çš„å…¨é¢è¿ç§»ã€‚

  - [ ] é…ç½®ç®¡ç†ï¼šä½¿ç”¨ @ConfigurationProperties å®ç°ç±»å‹å®‰å…¨çš„é…ç½®ï¼Œå°†é…ç½®ä¸ä»£ç åˆ†ç¦»ã€‚

  - [ ] å‚æ•°æ ¡éªŒï¼šåœ¨ Controller å±‚ä½¿ç”¨ @Valid æ³¨è§£å¯¹è¾“å…¥DTOè¿›è¡Œè‡ªåŠ¨åŒ–æ ¡éªŒã€‚

  - [ ] ä¸šåŠ¡é€»è¾‘ï¼šåœ¨å®ä½“ä¸­ä½¿ç”¨ Java Enum æ›¿ä»£ String æ¥ç®¡ç†çŠ¶æ€ï¼Œæå‡ç±»å‹å®‰å…¨ã€‚

- [ ] ğŸŸï¸ æ ¸å¿ƒåŠŸèƒ½é—­ç¯ (Payment Flow):

  - [âœ“] å·²å®Œæˆ TicketService çš„é‡æ„ï¼Œæ”¯æŒåŒæ­¥åˆ›å»ºâ€œå¾…æ”¯ä»˜â€è®¢å•ã€‚

  - [ ] å¼€å‘æ”¯ä»˜æ¥å£ (/pay)ï¼Œæ¨¡æ‹Ÿç”¨æˆ·æ”¯ä»˜å¹¶æ›´æ–°è®¢å•çŠ¶æ€ä¸º PAIDã€‚

  - [ ] å®ç°åŸºäº Redis Key è¿‡æœŸæˆ–å»¶æ—¶é˜Ÿåˆ—çš„æœºåˆ¶ï¼Œè‡ªåŠ¨å–æ¶ˆè¶…æ—¶æœªæ”¯ä»˜çš„è®¢å•å¹¶é‡Šæ”¾åº§ä½ã€‚

- [ ] âš¡ åŸºç¡€è®¾æ–½å‡çº§ (Infrastructure):

  - [ ] æ¶ˆæ¯é˜Ÿåˆ—ï¼šå°†æ¶ˆæ¯ä¸­é—´ä»¶ä» RabbitMQ å‡çº§åˆ° Kafka é›†ç¾¤ï¼Œä»¥è·å¾—æè‡´çš„ååé‡å’Œæ•°æ®æŒä¹…æ€§ã€‚

  - [ ] æ•°æ®åº“ä¸ç¼“å­˜ï¼šä¸º MySQL å’Œ Redis æ­å»ºé«˜å¯ç”¨é›†ç¾¤ã€‚

- [ ] â˜ï¸ äº‘åŸç”Ÿéƒ¨ç½²ä¸æµ‹è¯• (Cloud Native & Testing):

  - [ ] å°†æ•´ä¸ªç³»ç»Ÿé€šè¿‡ Docker å®¹å™¨åŒ–ï¼Œå¹¶éƒ¨ç½²åˆ° Azure Kubernetes Service (AKS) äº‘å¹³å°ã€‚

  - [ ] ä½¿ç”¨ JMeter åœ¨ Azure äº‘ç«¯è¿›è¡Œå¤§è§„æ¨¡ã€é«˜å¹¶å‘çš„å‹åŠ›æµ‹è¯•ä¸éªŒè¯ã€‚

- [ ] ğŸ–¥ï¸ ä¸°å¯Œçš„ç”¨æˆ·ä½“éªŒ (Frontend):

  - [ ] æ„å»ºä¸€ä¸ªæ”¯æŒå¯è§†åŒ–é€‰åº§çš„å‰ç«¯ç•Œé¢ï¼ˆå¦‚ä½¿ç”¨ React æˆ– Vueï¼‰ã€‚

  - [ ] é€šè¿‡ WebSocket å®ç°åº§ä½çŠ¶æ€ï¼ˆå¯é€‰ã€å·²é”å®šã€å·²å”®ï¼‰çš„å®æ—¶æ›´æ–°ã€‚

ç”Ÿäº§çº§èƒ½åŠ›å¢å¼º (Advanced Enhancements):
- [ ] ğŸ›¡ï¸ ç³»ç»Ÿé«˜å¯ç”¨ä¿éšœ: å¼•å…¥ API ç½‘å…³ (å¦‚ Spring Cloud Gateway) å®ç°ç»Ÿä¸€çš„è·¯ç”±ã€é™æµå’Œç†”æ–­ã€‚

- [ ] ğŸ“Š å…¨é¢çš„å¯è§‚æµ‹æ€§: é›†æˆ Prometheus å’Œ Grafanaï¼Œå»ºç«‹å®Œå–„çš„ç›‘æ§ã€å‘Šè­¦å’Œåˆ†å¸ƒå¼æ—¥å¿—ç³»ç»Ÿã€‚

- [ ] ğŸ”„ å…¨é“¾è·¯å¹‚ç­‰æ€§: ç¡®ä¿æ‰€æœ‰â€œå†™â€æ“ä½œï¼ˆå¦‚ä¸‹å•ã€æ”¯ä»˜ï¼‰çš„å¹‚ç­‰æ€§ï¼Œé˜²æ­¢é‡å¤å¤„ç†ã€‚

- [ ] âš™ï¸ è‡ªåŠ¨åŒ–è¿ç»´: å»ºç«‹å®Œæ•´çš„ CI/CD æµç¨‹ï¼Œå®ç°è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²ã€‚

### 2. å½“å‰é¡¹ç›®è¿›åº¦ (Current Progress)
æˆ‘ä»¬å·²ç»æˆåŠŸåœ°å®Œæˆäº†é¡¹ç›®ä»åˆå§‹åŸå‹åˆ°ç°ä»£åŒ–æ¶æ„çš„å…³é”®è½¬å‹ã€‚è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„é‡Œç¨‹ç¢‘ã€‚

âœ… å·²å®Œæˆ (Completed):
1. æ­å»ºäº†åŸºäºCQRSçš„åˆå§‹æ¶æ„:

  - ä½¿ç”¨ TicketingPlatform ä½œä¸ºå†™æ¨¡å‹ï¼ˆCommandï¼‰ï¼ŒRabbitCombinedConsumer ä½œä¸ºè¯»æ¨¡å‹ï¼ˆQueryï¼‰ã€‚

  - æˆåŠŸåœ°å°†â€œè´­ç¥¨è¯·æ±‚â€å’Œâ€œæ•°æ®æŒä¹…åŒ–â€é€šè¿‡ RabbitMQ è¿›è¡Œäº†è§£è€¦ã€‚

  - å®ç°äº†åŸºäº Redis å’Œ Lua è„šæœ¬çš„ã€åŸå­æ€§çš„é«˜å¹¶å‘åº§ä½é”å®šæœºåˆ¶ï¼Œè¿™æ˜¯æ•´ä¸ªé¡¹ç›®æŠ€æœ¯å«é‡æœ€é«˜çš„æ ¸å¿ƒäº®ç‚¹ã€‚

  2. å®Œæˆäº†æ•°æ®è®¿é—®å±‚çš„ç°ä»£åŒ–é‡æ„ (DAO -> JPA)ï¼š

  - æˆåŠŸå°†æ‰€æœ‰ model ç±»æ”¹é€ ä¸ºå¸¦æœ‰å…³ç³»æ˜ å°„çš„ JPA å®ä½“ (@Entity)ã€‚

  - ä½¿ç”¨ Spring Data JPA Repository å½»åº•æ›¿æ¢äº†æ‰‹å†™ SQL çš„ JdbcTicketDaoï¼Œå¤§å¹…ç®€åŒ–äº†ä»£ç ï¼Œæå‡äº†å¼€å‘æ•ˆç‡å’Œå¥å£®æ€§ã€‚

  - æ¸…æ™°åœ°åˆ’åˆ†äº† DTOï¼ˆæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰å’Œ Entityï¼ˆæ•°æ®åº“å®ä½“ï¼‰çš„èŒè´£ï¼Œä¼˜åŒ–äº†é¡¹ç›®ç»“æ„ã€‚

3. é‡æ„äº†æ ¸å¿ƒæœåŠ¡ä»¥æ”¯æŒæ”¯ä»˜æµç¨‹:

  - TicketService çš„æ ¸å¿ƒé€»è¾‘å·²ä»â€œå¼‚æ­¥å‘é€æ¶ˆæ¯â€é‡æ„ä¸ºâ€œåŒæ­¥åˆ›å»ºå¾…æ”¯ä»˜è®¢å•â€ï¼Œä¸ºå®ç°æ”¯ä»˜åŠŸèƒ½é“ºå¹³äº†é“è·¯ã€‚

  - QueryService çš„èŒè´£æ›´åŠ æ˜ç¡®ï¼Œä¸“é—¨è´Ÿè´£æ‰€æœ‰è¯»æ“ä½œï¼Œå¹¶å¼•å…¥äº†è‡ªå®šä¹‰å¼‚å¸¸ TicketNotFoundException æ¥è¿›è¡Œä¸“ä¸šçš„é”™è¯¯å¤„ç†ã€‚

### 3. ä»£ç ç®€åŒ–ä¸ä¼˜åŒ–å»ºè®® (Spring Boot Simplifications)
åœ¨æˆ‘ä»¬çš„é‡æ„è¿‡ç¨‹ä¸­ï¼Œå¤§éƒ¨åˆ†ä»£ç å·²ç»éå¸¸ç°ä»£åŒ–äº†ã€‚ä½†ä»ç„¶æœ‰ä¸€äº›åœ°æ–¹å¯ä»¥åˆ©ç”¨ Spring Boot çš„ç‰¹æ€§è¿›è¡Œè¿›ä¸€æ­¥çš„ç®€åŒ–å’Œä¼˜åŒ–ã€‚

ğŸ”¹ Controller å±‚ï¼šä½¿ç”¨ DTO æ¥æ”¶è¯·æ±‚ä½“
ä½ å½“å‰çš„ TicketPurchaseController å¯èƒ½è¿˜åœ¨æ¥æ”¶é›¶æ•£çš„å‚æ•°ã€‚æœ€ä½³å®è·µæ˜¯ç›´æ¥æ¥æ”¶ä¸€ä¸ª DTO å¯¹è±¡ã€‚

ä¼˜åŒ–å‰:
```java
// @PostMapping("/purchase")
// public TicketRespondDTO purchaseTicket(@RequestParam String eventId, ...) { ... }
```

ä¼˜åŒ–å:
```java
@RestController
@RequestMapping("/api/tickets")
@RequiredArgsConstructor
public class TicketPurchaseController {

    private final TicketServiceInterface ticketService;

    // ä½¿ç”¨ @RequestBody å°† JSON è¯·æ±‚ä½“è‡ªåŠ¨è½¬æ¢ä¸ºä¸€ä¸ª DTO å¯¹è±¡
    @PostMapping("/purchase")
    public ResponseEntity<TicketRespondDTO> purchaseTicket(@RequestBody TicketPurchaseRequestDTO request) {
        // 1. åœ¨ Controller å±‚ç»„è£… TicketCreationDTO
        TicketCreationDTO creationDTO = new TicketCreationDTO(
            UUID.randomUUID().toString(), // åœ¨æœåŠ¡å™¨ç«¯ç”Ÿæˆå”¯ä¸€ID
            request.getVenueId(),
            request.getEventId(),
            request.getZoneId(),
            request.getColumn(),
            request.getRow(),
            Instant.now() // åœ¨æœåŠ¡å™¨ç«¯ç”Ÿæˆåˆ›å»ºæ—¶é—´
        );

        // 2. è°ƒç”¨ Service
        TicketRespondDTO response = ticketService.purchaseTicket(creationDTO);
        return ResponseEntity.ok(response);
    }
}
```

å¥½å¤„ï¼šæ¥å£æ›´æ¸…æ™°ï¼Œæ‰©å±•æ€§æ›´å¼ºï¼Œå¹¶ä¸”å¯ä»¥åœ¨ TicketPurchaseRequestDTO ä¸Šæ·»åŠ  @Valid æ³¨è§£æ¥è¿›è¡Œè‡ªåŠ¨å‚æ•°æ ¡éªŒã€‚

ğŸ”¹ é…ç½®ç±»ï¼šåˆ©ç”¨ @ConfigurationProperties
åœ¨ä½ çš„ RabbitFactory æˆ–å…¶ä»–é…ç½®ç±»ä¸­ï¼Œä½ å¯èƒ½æ˜¯ç¡¬ç¼–ç äº†ä¸€äº›é…ç½®å€¼ã€‚å¯ä»¥æŠŠå®ƒä»¬æå–åˆ° application.yml ä¸­ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªç±»å‹å®‰å…¨çš„é…ç½®ç±»æ¥è¯»å–ã€‚

ä¼˜åŒ–å‰:
```java
// public class RabbitFactory {
//     public static final String EXCHANGE_NAME = "ticket.exchange";
// }
```

ä¼˜åŒ–å:
application.yml:
```java
rabbitmq-config:
  exchange-name: ticket.exchange
  queues:
    mysql-queue: mysql.queue
```

RabbitMQProperties.java:
```java
@ConfigurationProperties(prefix = "rabbitmq-config")
@Data
public class RabbitMQProperties {
    private String exchangeName;
    private Map<String, String> queues;
}
```

RabbitFactory.java:
```java
@Configuration
@EnableConfigurationProperties(RabbitMQProperties.class)
public class RabbitFactory {
    private final RabbitMQProperties properties;
    // ... åœ¨æ„é€ å‡½æ•°ä¸­æ³¨å…¥ properties å¹¶ä½¿ç”¨å®ƒ
}
```

å¥½å¤„ï¼šæ‰€æœ‰é…ç½®é›†ä¸­ç®¡ç†ï¼Œæ”¯æŒä¸åŒç¯å¢ƒçš„é…ç½®åˆ‡æ¢ï¼Œä»£ç æ›´å¹²å‡€ã€‚

ğŸ”¹ å®ä½“ç±»ï¼šä½¿ç”¨ Java Enum æ˜ å°„ status å­—æ®µ
æˆ‘ä»¬ä¹‹å‰è®¨è®ºè¿‡ï¼Œè¿™æ˜¯ VARCHAR æ–¹æ¡ˆçš„æœ€ä½³æ­æ¡£ã€‚

ä¼˜åŒ–å:
```java
// åˆ›å»ºä¸€ä¸ªæšä¸¾ç±»
public enum TicketStatus {
    PENDING_PAYMENT,
    PAID,
    CANCELLED
}

// åœ¨ TicketInfo.java ä¸­ä½¿ç”¨
@Entity
public class TicketInfo {
    // ...
    @Enumerated(EnumType.STRING) // å‘Šè¯‰JPAå°†Enumæ˜ å°„ä¸ºå­—ç¬¦ä¸²
    @Column(name = "status", nullable = false)
    private TicketStatus status;
}
```
å¥½å¤„ï¼šåœ¨Javaä»£ç å±‚é¢å®ç°äº†ç±»å‹å®‰å…¨ï¼Œæœç»äº†æ‹¼å†™é”™è¯¯ï¼Œè®©ä»£ç æ„å›¾æ›´æ¸…æ™°ã€‚